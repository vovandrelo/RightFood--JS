"use strict";

/* <================================================================================================================> */
/* <============================================== ИМПОРТ НЕОБХОДИМЫХ МОДУЛЕЙ ======================================> */
/* <================================================================================================================> */

import express from 'express';
import multer from 'multer';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

/* <================================================================================================================> */
/* <=============================================== КОНФИГУРАЦИЯ ПРИЛОЖЕНИЯ ========================================> */
/* <================================================================================================================> */

/* <======================================= НАСТРОЙКА РАБОТЫ __DIRNAME И __FILENAME ================================> */

const app = express();
const __filename = fileURLToPath(import.meta.url);  // jshint ignore:line
const __dirname = dirname(__filename);              // jshint ignore:line

/* <======================================== УСТАНОВКА ПУТИ ДО СТАТИЧЕСКИХ ФАЙЛОВ ==================================> */

app.use(express.static(join(__dirname, "..", "public")));

/* <============================================= УСТАНОВКА ПРЕПРОЦЕССОРА PUG ======================================> */

app.set('view engine', 'pug');                      // Установка движка PUG
app.set('views', join(__dirname, 'views/pages'));   // Путь до папки, из которой будут компилироваться страницы

/* <==================================================== ПАРСИНГ JSON ==============================================> */

app.use(express.json());

/* <================================================================================================================> */
/* <============================================== ИМПОРТ НЕОБХОДИМЫХ РОУТОВ =======================================> */
/* <================================================================================================================> */

import productRouter from "./routes/product-routes.js";
import authRouter from "./routes/auth-routes.js";
import recipeRouter from "./routes/recipe-routes.js";
import enegryValueRouter from "./routes/enegryValue-router.js";

/* <================================================================================================================> */
/* <==================================================== ЗАПУСК РОУТОВ =============================================> */
/* <================================================================================================================> */

app.get("/", (req, res) => {
    res.render("index.pug");
});

app.use("/products", productRouter);
app.use("/auth", authRouter);
app.use("/recipes", recipeRouter);
app.use("/enegryValue", enegryValueRouter);

app.get('*', (req, res) => {
    res.status(404).send('what???');
});

/* <================================================================================================================> */
/* <=================================================== EXPRESS - СЕРВЕР ===========================================> */
/* <================================================================================================================> */

app.listen(3000, () => {
    console.log("Server is running!");
});